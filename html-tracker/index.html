<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>ONOENDI Device Tracker</title>
<meta name="description" content="Device tracker by Yugan Studio Works.">
<meta name="keywords" content="latitude, longitude, ONOENDI, device tracker, Yugan Studio">
</head>
<body onload="xz()">
<table cellpadding="0" cellspacing="0" border="0">
<tr>
<td><h2>ONOENDI</h2></td>
<td><font style="clear:both; padding:1px; font-size:9pt; font-family:arial, helvetica, sans-serif">&nbsp; product by Yugan Studio Works</font></td>
</tr>
</table>
<center>
<table cellpadding="5" cellspacing="0" border="1">
<tr>
<td width="60%" valign="top">
<div id="wrapper" style="margin:5px">
<div id="map" style="width: 900px; height: 475px"></div>
</div>
</td>
<td valign="top">
<font style="clear:both; font-weight: bold; font-size:15pt; font-family:arial, helvetica, sans-serif">Get the Latitude and Longitude</font>
<hr>
<table width="100%" border="0">
<tr><td width="30%"><code>Device Id</code></td><td><div style="font-weight: bold; font-size: 10pt" id="device_id"></td></tr>
<tr><td><code>Registered to</code></td><td><div style="font-size: 9pt; font-family:Trebuchet MS, Helvetica, sans-serif" id="owner"></div></td></tr>
<tr><td><code>Latitude</code></td><td><div style="color:#0000FF; font-size: 10pt" id="latbox"></td></tr>
<tr><td><code>Longitude</code></td><td><div style="color:#0000FF; font-size: 10pt" id="lonbox"></td></tr>
<tr><td><code>Moving Speed</code></td><td><div style="font-size: 9pt; font-family:Trebuchet MS, Helvetica, sans-serif" id="mspeed"></div><code><font size="2">&nbsp;Kmh</font></code></td></tr>
<tr><td><code>Last Move</code></td><td><div style="font-size: 9pt; font-family:Trebuchet MS, Helvetica, sans-serif" id="lmove"></td></tr>
<tr><td><code>Lost mode? <code><input type="checkbox" onclick='modeClick(this);'></td></tr>
<tr><td colspan="2"><hr></td></tr>
<tr><td colspan="2"><div style="font-size: 8pt; font-family:Tahoma, Geneva, sans-serif" id="rfresh"></div></td></tr>
</table>
</td>
</tr>
</table>
</td>
</tr></table>
</div>
</div>
</center>
<form name="mapform" id="mapform" action="gettinglocation" method="POST">
<input type="hidden" value="GP2136EF" name="device_id"/>
</form>
<!-- footer :D -->
<br>
<center><font style="clear:both; padding:10px; text-align:center; font-size:10pt; font-family:arial, helvetica, sans-serif">Copyright Â© 2015 Yugan Studio Works All Rights Reserved.</font></center>
    <!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript">
//<![CDATA[
// Latitude and Longitude math routines are from: http://www.fcc.gov/mb/audio/bickel/DDDMMSS-decimal.html

var map = null;
var marker = null;
var ls='';
var lm='';
var ld='';
var lgs='';
var lgm='';
var lgd='';
var latbox='';
var lonbox='';
var t = 5;
var mrks = {mvcMarkers: new google.maps.MVCArray()};
var iw;
var drag=false;

function xz() {
ll = new google.maps.LatLng(-6.117427, 106.153011);
zoom=13;

var mO = {
scaleControl:true,
zoom:zoom,
zoomControl:false,
zoomControlOptions: {style:google.maps.ZoomControlStyle.LARGE},
center: ll,
disableDoubleClickZoom:true,
mapTypeId: google.maps.MapTypeId.ROADMAP
};

map = new google.maps.Map(document.getElementById("map"), mO);
map.setTilt(0);
map.panTo(ll);
marker = new google.maps.Marker({position:ll,map:map,draggable:false,title:'Lokasi terakhir'});   

	google.maps.event.addListener(marker, 'click', function(mll) {
	gC(mll.latLng);
	var html= "<div style='color:#000;background-color:#fff;padding:5px;width:150px;'><p>Latitude - Longitude:<br />" + String(mll.latLng.toUrlValue()) + "<br /><br />Lat: " + ls +  "&#176; " + lm +  "&#39; "  + ld + "&#34;<br />Long: " + lgs +  "&#176; " + lgm +  "&#39; " + lgd + "&#34;</p></div>";
	iw = new google.maps.InfoWindow({content:html});
	iw.open(map,marker);
	});
	google.maps.event.addListener(marker, 'dragstart', function() {if (iw){iw.close();}});

	google.maps.event.addListener(marker, 'dragend', function(event) {
	if (map.getZoom() < 10){map.setZoom(10);}
	map.setCenter(event.latLng);
	computepos(event.latLng);
	drag=true;
	setTimeout(function(){drag=false;},250);
	});

	google.maps.event.addListener(map, 'click', function(event) {
	if (drag){return;}
	fc(event.latLng) ;
	if (map.getZoom() < 10){map.setZoom(10);}
	map.panTo(event.latLng);
	computepos(event.latLng);
	});
}

function computepos (point)
{
var latA = Math.abs(Math.round(point.lat() * 1000000.));
var lonA = Math.abs(Math.round(point.lng() * 1000000.));
if(point.lat() < 0)
{
	var ls = '-' + Math.floor((latA / 1000000)).toString();
}
else
{
	var ls = Math.floor((latA / 1000000)).toString();
}
var lm = Math.floor(((latA/1000000) - Math.floor(latA/1000000)) * 60).toString();
var ld = ( Math.floor(((((latA/1000000) - Math.floor(latA/1000000)) * 60) - Math.floor(((latA/1000000) - Math.floor(latA/1000000)) * 60)) * 100000) *60/100000 ).toString();
if(point.lng() < 0)
{
  var lgs = '-' + Math.floor((lonA / 1000000)).toString();
}
else
{
	var lgs = Math.floor((lonA / 1000000)).toString();
}
var lgm = Math.floor(((lonA/1000000) - Math.floor(lonA/1000000)) * 60).toString();
var lgd = ( Math.floor(((((lonA/1000000) - Math.floor(lonA/1000000)) * 60) - Math.floor(((lonA/1000000) - Math.floor(lonA/1000000)) * 60)) * 100000) *60/100000 ).toString();
//document.getElementById("latbox").value=point.lat().toFixed(6);
document.getElementById("latbox").innerHTML = point.lat().toFixed(6);
//document.getElementById("latboxm").value=ls;
//document.getElementById("latboxmd").value=lm;
//document.getElementById("latboxms").value=ld;
//document.getElementById("lonbox").value=point.lng().toFixed(6);
document.getElementById("lonbox").innerHTML = point.lng().toFixed(6);
//document.getElementById("lonboxm").value=lgs;
//document.getElementById("lonboxmd").value=lgm;
//document.getElementById("lonboxms").value=lgd;
}

function gC(ll){
var latA = Math.abs(Math.round(ll.lat() * 1000000.));
var lonA = Math.abs(Math.round(ll.lng() * 1000000.));
if(ll.lat() < 0)
{
	var tls = '-' + Math.floor((latA / 1000000)).toString();
}
else
{
	var tls = Math.floor((latA / 1000000)).toString();
}
var tlm = Math.floor(((latA/1000000) - Math.floor(latA/1000000)) * 60).toString();
var tld = ( Math.floor(((((latA/1000000) - Math.floor(latA/1000000)) * 60) - Math.floor(((latA/1000000) - Math.floor(latA/1000000)) * 60)) * 100000) *60/100000 ).toString();
ls = tls.toString();
lm = tlm.toString();
ld = tld.toString();

if(ll.lng() < 0)
{
  var tlgs = '-' + Math.floor((lonA / 1000000)).toString();
}
else
{
	var tlgs = Math.floor((lonA / 1000000)).toString();
}
var tlgm = Math.floor(((lonA/1000000) - Math.floor(lonA/1000000)) * 60).toString();
var tlgd = ( Math.floor(((((lonA/1000000) - Math.floor(lonA/1000000)) * 60) - Math.floor(((lonA/1000000) - Math.floor(lonA/1000000)) * 60)) * 100000) *60/100000 ).toString();
lgs = tlgs.toString();
lgm = tlgm.toString();
lgd = tlgd.toString();
}

function Marking(latbox,lonbox) {
	//ll = new google.maps.LatLng(document.getElementById("latbox").value, document.getElementById("lonbox").value);
	//ll = new google.maps.LatLng(-6.105906, 106.155328); 
	ll = new google.maps.LatLng(latbox, lonbox); 
	map.panTo(ll);
	computepos(ll);
	// for tracking the 'Lost-Mode'
	//markit = new google.maps.Marker({position:ll,map:map,draggable:true,title:'Marker is Draggable'}); 
	//markit.setPosition(map.getCenter());
	marker.setPosition(map.getCenter());
}

var myVar = setInterval(function(){timecount();},1000);

function getlatlon() {	
	var formData = $("#mapform").serializeArray();
	
	var URL = $("#mapform").attr('action');
	$.post(URL, formData, function(data, textStatus, jqXHR){
		var geoloc = JSON.parse(data);
		//alert(geoloc.device_id);
		Marking(geoloc.latitude,geoloc.longitude);
		document.getElementById("device_id").innerHTML = geoloc.device_id;
		document.getElementById("owner").innerHTML = 'Luqman Sahidin';
		document.getElementById("lmove").innerHTML = geoloc.lastmove;
			
	}).fail(function(jqXHR, textStatus, errorThrown) 
	{
		$("#msg").html('<pre><code class="prettyprint">AJAX Request Failed<br/> textStatus='+textStatus+', errorThrown='+errorThrown+'</code></pre>');
	});
}

function modeClick(vl){
	alert("Now lost mode is " + vl.checked);
}

function timecount() {
	document.getElementById("rfresh").innerHTML = 'wait ' + t +' second(s) to update';
	t = t-1;
	if (t<0) {
		getlatlon();
		t = 5;
	}
}

//]]>
</script>
</body>
</html>